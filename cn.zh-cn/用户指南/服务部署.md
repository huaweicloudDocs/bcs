# 服务部署<a name="bcs_usermanual_0001"></a>

购买区块链服务时需要您为区块链服务配置基本参数和网络节点，以便快速完成区块链服务的创建及部署。

如果您还未订购区块链服务需要的相关资源，则也可直接[一键式部署区块链](https://support.huaweicloud.com/qs-bcs/bcs_qs_0002.html)[一键式部署区块链](https://support-intl.huaweicloud.com/zh-cn/qs-bcs/bcs_qs_0002.html)。

## 前提条件<a name="section4742631010333"></a>

-   若您使用租户创建的用户进行操作，为了使用户有足够的权限操作区块链服务，请在创建用户时为用户赋予如下权限：BCS Administrator、CCE Administrator、SWR Admin、VPC Administrator、SFS Administrator、Tenant Administrator、BSS Administrator。

    您可以通过先创建用户组并授权再将用户加入到用户组的方式，使用户具有用户组中的权限。具体操作请参见如下页面：

    -   [如何创建用户组并授权](https://support.huaweicloud.com/usermanual-iam/zh-cn_topic_0046611269.html)
    -   [如何创建用户组并授权](https://support-intl.huaweicloud.com/zh-cn/usermanual-iam/zh-cn_topic_0046611269.html)
    -   [如何创建用户](https://support.huaweicloud.com/usermanual-iam/zh-cn_topic_0046611303.html)
    -   [如何创建用户](https://support-intl.huaweicloud.com/zh-cn/usermanual-iam/zh-cn_topic_0046611303.html)

-   由于区块链服务中的Peer节点、共识节点以及链代码均需要运行在容器中。订购区块链服务前，确保已完成[环境准备](https://support.huaweicloud.com/qs-bcs/bcs_qs_0001.html)[环境准备](https://support-intl.huaweicloud.com/zh-cn/qs-bcs/bcs_qs_0001.html)工作。

## 操作步骤<a name="section3821583010823"></a>

1.  登录区块链服务管理控制台。
2.  单击页面右上角的“购买区块链服务”。

    ![](figures/zh-cn_image_0140074209.png)

3.  在购买页面填写相关参数。

    **表 1**  参数列表

    <a name="table30889701101225"></a>
    <table><thead align="left"><tr id="row24967194101225"><th class="cellrowborder" valign="top" width="16.98%" id="mcps1.2.4.1.1"><p id="p14582442101225"><a name="p14582442101225"></a><a name="p14582442101225"></a>参数类型</p>
    </th>
    <th class="cellrowborder" valign="top" width="23.93%" id="mcps1.2.4.1.2"><p id="p40327186101225"><a name="p40327186101225"></a><a name="p40327186101225"></a>参数名称</p>
    </th>
    <th class="cellrowborder" valign="top" width="59.089999999999996%" id="mcps1.2.4.1.3"><p id="p45276618101225"><a name="p45276618101225"></a><a name="p45276618101225"></a>说明</p>
    </th>
    </tr>
    </thead>
    <tbody><tr id="row25139502102547"><td class="cellrowborder" valign="top" width="16.98%" headers="mcps1.2.4.1.1 "><p id="p23033770102547"><a name="p23033770102547"></a><a name="p23033770102547"></a>计费</p>
    </td>
    <td class="cellrowborder" valign="top" width="23.93%" headers="mcps1.2.4.1.2 "><p id="p53796042102547"><a name="p53796042102547"></a><a name="p53796042102547"></a>计费模式</p>
    </td>
    <td class="cellrowborder" valign="top" width="59.089999999999996%" headers="mcps1.2.4.1.3 "><p id="p116414517282"><a name="p116414517282"></a><a name="p116414517282"></a>支持包年/包月、按需计费。</p>
    </td>
    </tr>
    <tr id="row4836379101225"><td class="cellrowborder" rowspan="14" valign="top" width="16.98%" headers="mcps1.2.4.1.1 "><p id="p56202447101225"><a name="p56202447101225"></a><a name="p56202447101225"></a>基本信息</p>
    </td>
    <td class="cellrowborder" valign="top" width="23.93%" headers="mcps1.2.4.1.2 "><p id="p56104359101225"><a name="p56104359101225"></a><a name="p56104359101225"></a>区块链服务名称</p>
    </td>
    <td class="cellrowborder" valign="top" width="59.089999999999996%" headers="mcps1.2.4.1.3 "><p id="p48159244101225"><a name="p48159244101225"></a><a name="p48159244101225"></a>支持中英文字符及数字，长度为4-24个字符。</p>
    </td>
    </tr>
    <tr id="row456051213910"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p18560111213911"><a name="p18560111213911"></a><a name="p18560111213911"></a>版本类型</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p185602012173919"><a name="p185602012173919"></a><a name="p185602012173919"></a>支持基础版、专业版。各版本区别请参见<a href="https://support.huaweicloud.com/productdesc-bcs/bcs_productdesc_0007.html" target="_blank" rel="noopener noreferrer">版本规格说明</a><a href="https://support-intl.huaweicloud.com/zh-cn/productdesc-bcs/bcs_productdesc_0007.html" target="_blank" rel="noopener noreferrer">版本规格说明</a>。</p>
    </td>
    </tr>
    <tr id="row153267106514"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p6326191019517"><a name="p6326191019517"></a><a name="p6326191019517"></a>区块链类型</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p1652853218462"><a name="p1652853218462"></a><a name="p1652853218462"></a>可选择创建私有链或者联盟链。</p>
    <p id="p9698103015478"><a name="p9698103015478"></a><a name="p9698103015478"></a>私有链：仅本租户内部使用的区块链服务。</p>
    <p id="p13182172614711"><a name="p13182172614711"></a><a name="p13182172614711"></a>联盟链：可以邀请其他租户一起参与的区块链服务。</p>
    </td>
    </tr>
    <tr id="row30780014101225"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p17105524101225"><a name="p17105524101225"></a><a name="p17105524101225"></a>容器集群</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p43370175101225"><a name="p43370175101225"></a><a name="p43370175101225"></a>选择区块链服务部署在哪个容器集群上。一个集群容器只允许部署一个区块链服务。</p>
    </td>
    </tr>
    <tr id="row15130231163243"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p17589209163243"><a name="p17589209163243"></a><a name="p17589209163243"></a>网络存储</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p15439848163243"><a name="p15439848163243"></a><a name="p15439848163243"></a>选择已创建好的文件存储卷来保存区块链服务的相关数据。</p>
    </td>
    </tr>
    <tr id="row999521893618"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p1710111916364"><a name="p1710111916364"></a><a name="p1710111916364"></a>账本数据存储方式</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p171041953611"><a name="p171041953611"></a><a name="p171041953611"></a>选择用于数据存储的数据库类型。</p>
    <a name="ul54511737143920"></a><a name="ul54511737143920"></a><ul id="ul54511737143920"><li>文件数据库（goleveldb）。</li><li>关系数据库（MySQL）：若选择关系数据库，需要您提前创建好RDS实例，操作步骤可参见<a href="https://support.huaweicloud.com/qs-rds/zh-cn_topic_0046585334.html" target="_blank" rel="noopener noreferrer">购买实例</a><a href="https://support-intl.huaweicloud.com/zh-cn/qs-rds/zh-cn_topic_0046585334.html" target="_blank" rel="noopener noreferrer">购买实例</a>。<div class="notice" id="note1570351015499"><a name="note1570351015499"></a><a name="note1570351015499"></a><span class="noticetitle"> 注意： </span><div class="noticebody"><p id="p67037101494"><a name="p67037101494"></a><a name="p67037101494"></a>创建RDS实例时，您需要选择VPC、子网、内网安全组，这三个参数需要与部署区块链服务所使用容器集群里的任一节点的VPC、子网、内网安全组一致，否则会由于不在同子网而导致数据库不能访问。</p>
    </div></div>
    </li><li>NoSQL(couchdb)。</li></ul>
    </td>
    </tr>
    <tr id="row54787259101225"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p24136878101225"><a name="p24136878101225"></a><a name="p24136878101225"></a>peer节点组织</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p8930122101225"><a name="p8930122101225"></a><a name="p8930122101225"></a>为区块链服务添加节点组织，每个区块链服务最少添加一个，最多添加五个。每个节点组织的节点数量为1-5，即每个节点组织的实例数。</p>
    <p id="p3264131284017"><a name="p3264131284017"></a><a name="p3264131284017"></a>若数据库选择的是关系数据库，则需要为每个节点组织选择RDS实例、填写数据库用户名及密码。</p>
    </td>
    </tr>
    <tr id="row13262242101225"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p40483158101225"><a name="p40483158101225"></a><a name="p40483158101225"></a>共识策略</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p16609192814411"><a name="p16609192814411"></a><a name="p16609192814411"></a>提供的共识策略：测试策略（SOLO）、快速拜占庭容错共识算法（FBFT）、Kafka(CFT)。</p>
    </td>
    </tr>
    <tr id="row51431240101225"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p40701004142629"><a name="p40701004142629"></a><a name="p40701004142629"></a>安全机制</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p8447055142629"><a name="p8447055142629"></a><a name="p8447055142629"></a>支持ECDSA和国密算法。</p>
    </td>
    </tr>
    <tr id="row16244066142629"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p3635234416031"><a name="p3635234416031"></a><a name="p3635234416031"></a>版本信息</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p5885875316031"><a name="p5885875316031"></a><a name="p5885875316031"></a>选择区块链服务版本。</p>
    </td>
    </tr>
    <tr id="row4601311116031"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p3527643134110"><a name="p3527643134110"></a><a name="p3527643134110"></a>链代码&amp;区块管理初始密码</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p1952774311414"><a name="p1952774311414"></a><a name="p1952774311414"></a>设置登录链代码&amp;区块管理页面的初始密码。</p>
    </td>
    </tr>
    <tr id="row182339774316"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p10619127174218"><a name="p10619127174218"></a><a name="p10619127174218"></a>确认密码</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p96196784220"><a name="p96196784220"></a><a name="p96196784220"></a>再次确认输入链代码&amp;区块管理初始密码。</p>
    </td>
    </tr>
    <tr id="row644017536166"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p124407532169"><a name="p124407532169"></a><a name="p124407532169"></a>链代码调用Restful服务</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p1440165341611"><a name="p1440165341611"></a><a name="p1440165341611"></a>安装Restful服务可以使用Restful方式进行链代码调用，避免对SDK的依赖。提供的REST API请参见API参考手册。</p>
    </td>
    </tr>
    <tr id="row761912764210"><td class="cellrowborder" valign="top" headers="mcps1.2.4.1.1 "><p id="p17000946101225"><a name="p17000946101225"></a><a name="p17000946101225"></a>共识节点数量</p>
    </td>
    <td class="cellrowborder" valign="top" headers="mcps1.2.4.1.2 "><p id="p34899374101225"><a name="p34899374101225"></a><a name="p34899374101225"></a>即orderer节点的数量，默认为1。如果共识策略是快速拜占庭容错共识算法，那么共识节点数量应该大于等于4且小于等于10。</p>
    </td>
    </tr>
    <tr id="row45658910101225"><td class="cellrowborder" valign="top" width="16.98%" headers="mcps1.2.4.1.1 "><p id="p7384191101225"><a name="p7384191101225"></a><a name="p7384191101225"></a>通道配置</p>
    </td>
    <td class="cellrowborder" valign="top" width="23.93%" headers="mcps1.2.4.1.2 "><p id="p61248593101225"><a name="p61248593101225"></a><a name="p61248593101225"></a>添加通道</p>
    </td>
    <td class="cellrowborder" valign="top" width="59.089999999999996%" headers="mcps1.2.4.1.3 "><p id="p62188987101225"><a name="p62188987101225"></a><a name="p62188987101225"></a>点击“添加通道”为区块链服务添加通道，用于节点组织之间的通信。完成后再为每个通道添加节点组织。</p>
    <div class="note" id="note1186583113237"><a name="note1186583113237"></a><a name="note1186583113237"></a><span class="notetitle"> 说明： </span><div class="notebody"><p id="p323817335203"><a name="p323817335203"></a><a name="p323817335203"></a>如果您在部署服务时未配置通道，可在<a href="https://support.huaweicloud.com/usermanual-bcs/bcs_usermanual_0004.html" target="_blank" rel="noopener noreferrer">通道管理</a><a href="https://support-intl.huaweicloud.com/zh-cn/usermanual-bcs/bcs_usermanual_0004.html" target="_blank" rel="noopener noreferrer">通道管理</a>页面创建通道并进行通道与服务的绑定。</p>
    </div></div>
    </td>
    </tr>
    <tr id="row113205479408"><td class="cellrowborder" valign="top" width="16.98%" headers="mcps1.2.4.1.1 "><p id="p4320114764020"><a name="p4320114764020"></a><a name="p4320114764020"></a>-</p>
    </td>
    <td class="cellrowborder" valign="top" width="23.93%" headers="mcps1.2.4.1.2 "><p id="p117170167435"><a name="p117170167435"></a><a name="p117170167435"></a>购买时长</p>
    </td>
    <td class="cellrowborder" valign="top" width="59.089999999999996%" headers="mcps1.2.4.1.3 "><p id="p65844467103430"><a name="p65844467103430"></a><a name="p65844467103430"></a>计费模式若选择包年/包月，则需要选择购买时长。</p>
    </td>
    </tr>
    </tbody>
    </table>

4.  配置完成后，单击“立即购买”，等待区块链服务完成创建及部署。

## 后续操作<a name="section81291214158"></a>

部署BCS的集群节点支持增加反亲和标签，在您需要将应用部署到区块链集群中时作区分隔离，以保证系统正常工作。

1.  登录CCE控制台，选择“资源管理 \> 节点管理”，可以看到节点列表，单击“操作”栏的“标签管理”。
2.  单击“添加标签”，填写需要增加标签的“键”为“nodeScope”、“值”为“userApplication”。
3.  单击“确定”，可以看到“标签变更成功”，再次单击“标签管理”，可查看到已经添加的标签。

更多详细的操作请参见CCE帮助中心中的[节点标签管理](https://support.huaweicloud.com/usermanual-cce/cce_01_0004.html)[节点标签管理](https://support-intl.huaweicloud.com/zh-cn/usermanual-cce/cce_01_0004.html)。

